<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LazySPA â€¢ Games</title>
    <meta name="color-scheme" content="light dark" />
    <style>
      :root { color-scheme: light dark; }
      html, body { height: 100%; }
      body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial; background: Canvas; color: CanvasText; }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 32px 20px 48px; }
      header { display: flex; align-items: baseline; justify-content: space-between; gap: 12px; margin-bottom: 24px; }
      h1 { font-size: 28px; margin: 0; letter-spacing: -0.02em; }
      .sub { color: GrayText; font-size: 14px; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 16px; }
      .card { display: block; border: 1px solid color-mix(in oklab, CanvasText 12%, transparent); border-radius: 12px; overflow: hidden; text-decoration: none; color: inherit; background: color-mix(in oklab, Canvas 94%, transparent); box-shadow: 0 1px 0 rgba(0,0,0,.03);
        transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease; }
      .card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,.08); border-color: color-mix(in oklab, CanvasText 18%, transparent); }
      .thumb { aspect-ratio: 16/9; background: color-mix(in oklab, CanvasText 6%, transparent); display: grid; place-items: center; }
      .thumb img { max-width: 70%; max-height: 70%; filter: drop-shadow(0 6px 10px rgba(0,0,0,.18)); }
      .body { padding: 14px 14px 16px; display:flex; flex-direction:column; gap:8px; }
      .title { font-size: 16px; font-weight: 600; margin: 0 0 4px; letter-spacing: -0.01em; }
      .desc { margin: 0; color: GrayText; font-size: 13px; }
      .row { display:flex; align-items:center; justify-content:space-between; gap:8px; }
      .chip { display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; border:1px solid color-mix(in oklab, CanvasText 14%, transparent); background: color-mix(in oklab, Canvas 92%, transparent); font-size:12px; text-decoration:none; color:inherit; }
      details { border-top: 1px dashed color-mix(in oklab, CanvasText 18%, transparent); padding-top: 10px; margin-top: 2px; }
      summary { cursor: pointer; list-style: none; display:flex; align-items:center; gap:8px; }
      summary::-webkit-details-marker { display:none; }
      .caret { display:inline-block; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 6px solid currentColor; transform: rotate(-90deg); opacity:.8; transition: transform .12s ease; }
      details[open] .caret { transform: rotate(0deg); }
      .history { display:grid; gap:6px; margin:10px 0 0; padding:0; }
      .history a { display:inline-block; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; padding:4px 8px; border-radius:8px; border:1px solid color-mix(in oklab, CanvasText 14%, transparent); text-decoration:none; color:inherit; background: color-mix(in oklab, Canvas 96%, transparent); }
      .empty { padding: 24px; border: 1px dashed color-mix(in oklab, CanvasText 18%, transparent); border-radius: 12px; background: color-mix(in oklab, Canvas 94%, transparent); }
      footer { margin-top: 28px; color: GrayText; font-size: 13px; }
      .badge { display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; border:1px solid color-mix(in oklab, CanvasText 14%, transparent); background: color-mix(in oklab, Canvas 92%, transparent); font-size:12px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>LazySPA</h1>
        <span class="sub" id="meta"></span>
      </header>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div id="empty" class="empty" hidden>No games found yet.</div>
      <footer>
        <span class="badge">Project Pages</span>
      </footer>
    </div>
    <script>
      const meta = document.getElementById('meta');
      const grid = document.getElementById('grid');
      const empty = document.getElementById('empty');
      const manifestUrl = new URL('./games.json', location.href).toString();

      function titleFromSlug(slug){
        return slug.replace(/[-_]/g,' ').replace(/\b\w/g, s => s.toUpperCase());
      }
      function card({ slug, latest, versions }){
        const a = document.createElement('a');
        a.className = 'card';
        a.href = latest || `./_games/${slug}/latest/`;
        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        const img = document.createElement('img');
        img.alt = slug;
        img.loading = 'lazy';
        img.src = './assets/logo-DCDVUE3s.svg';
        thumb.appendChild(img);
        const body = document.createElement('div');
        body.className = 'body';
        const h = document.createElement('h2');
        h.className = 'title';
        h.textContent = titleFromSlug(slug);
        const p = document.createElement('p');
        p.className = 'desc';
        p.textContent = 'Play in your browser';
        const row = document.createElement('div');
        row.className = 'row';
        const latestLink = document.createElement('a');
        latestLink.className = 'chip';
        latestLink.href = a.href;
        latestLink.textContent = 'Latest';
        const vcount = Array.isArray(versions) ? versions.length : 0;
        const meta = document.createElement('span');
        meta.className = 'desc';
        meta.textContent = vcount ? (vcount + ' versions') : '';
        row.append(meta, latestLink);

        // History section (collapsible)
        if (Array.isArray(versions) && versions.length) {
          const details = document.createElement('details');
          const summary = document.createElement('summary');
          const caret = document.createElement('span');
          caret.className = 'caret';
          const label = document.createElement('span');
          label.textContent = 'History';
          summary.append(caret, label);
          details.append(summary);

          const list = document.createElement('div');
          list.className = 'history';
          const max = Math.min(versions.length, 6);
          for (let i = 0; i < max; i++) {
            const v = versions[i];
            const link = document.createElement('a');
            const id = (v && v.id) ? String(v.id) : '';
            const shortId = id.length > 7 ? id.slice(0,7) : id;
            link.href = (v && v.url) ? v.url : `./_games/${slug}/${id}/`;
            link.textContent = shortId || 'version';
            link.title = id;
            list.appendChild(link);
          }
          details.appendChild(list);
          body.append(h, p, row, details);
        } else {
          body.append(h, p, row);
        }
        a.append(thumb, body);
        return a;
      }
      async function load(){
        try{
          const res = await fetch(manifestUrl, { cache: 'no-store' });
          if(!res.ok) throw new Error('manifest fetch failed');
          const data = await res.json();
          const games = Array.isArray(data.games) ? data.games : [];
          meta.textContent = games.length + ' game' + (games.length===1?'':'s');
          if(games.length===0){ empty.hidden = false; return; }
          for(const g of games){ grid.appendChild(card(g)); }
        }catch(err){
          // Fallback: show known slug(s) if manifest is missing
          meta.textContent = 'fallback mode';
          const fallback = [{ slug: 'daadi' }];
          for(const g of fallback){ grid.appendChild(card(g)); }
        }
      }
      load();
    </script>
  </body>
  </html>
